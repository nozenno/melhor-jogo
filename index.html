<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Ranking de Jogos</title>
</head>
<body>

<h1>Ranking de Jogos</h1>

<div id="ranking">
  <!-- Jogos serão renderizados aqui -->
</div>

<script>
const nomesJogos = {
  Half_Life_1: "Half-Life 1",
  GTA_5: "GTA 5",
  GTA_San_Andreas: "GTA: San Andreas",
  Need_For_Speed: "Need For Speed: Most Wanted",
  Final_Fantasy_7: "Final Fantasy 7",
  Half_Life_2: "Half-Life 2",
  Portal: "Portal",
  Portal_2: "Portal 2",
  Resident_Evil_4: "Resident Evil 4",
  Resident_Evil_5: "Resident Evil 5"
};

async function fetchRanking() {
  try {
    const res = await fetch("/api/obter-ranking");
    const data = await res.json();
    updateRanking(data);
  } catch (err) {
    console.error("Erro ao carregar ranking:", err);
    // Inicializa com zeros se der erro
    updateRanking(Object.fromEntries(Object.keys(nomesJogos).map(k => [k, 0])));
  }
}

async function vote(jogo, button) {
  button.disabled = true;
  try {
    const res = await fetch("/api/votar", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ jogo })
    });
    const data = await res.json();
    updateRanking(data);
  } catch (err) {
    console.error("Erro ao votar:", err);
  }
  button.disabled = false;
}

function updateRanking(data) {
  const rankingDiv = document.getElementById("ranking");
  rankingDiv.innerHTML = "";

  const jogosOrdenados = Object.entries(data).sort((a, b) => b[1] - a[1]);

  jogosOrdenados.forEach(([id, votos]) => {
    const div = document.createElement("div");
    div.innerHTML = `
      <span id="${id}">${votos}</span> - ${nomesJogos[id]}
      <button onclick="vote('${id}', this)">Votar</button>
    `;
    rankingDiv.appendChild(div);
  });
}

// Carrega o ranking real ao abrir a página
fetchRanking();
</script>

</body>
</html>
